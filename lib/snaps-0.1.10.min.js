define("tile",[],function(){function c(a,e,c,d,g,h,f){this.img=a;this.x=e;this.y=c;this.w=d;this.h=g;this.xoverdraw=h;this.yoverdraw=f}c.prototype.draw=function(a,e,c){a.drawImage(this.img,this.x,this.y,this.w,this.h,e-this.xoverdraw,c-this.yoverdraw,this.w,this.h)};return c});
define("sprites/spritedef",[],function(){function c(a,c,d){this.seq=a;this.dur=c;this.def=d}function a(a,c,d,g,h){this.states={};this.image=a;this.w=c;this.h=d;this.x=g;this.y=h}c.prototype.jogPos=function(a,c){var d;d=(c-a)%this.dur;return d/this.dur};c.prototype.draw=function(a,c,d,g,h){var f=this.def,g=this.seq[Math.floor(this.seq.length*this.jogPos(g,h))];a.drawImage(f.image,g.x,g.y,f.w,f.h,c,d,f.w,f.h)};a.prototype.addState=function(a,j,d){for(var g=[],h=Math.floor(this.image.width/this.w),f=
0;f<j.length;f++){var q=j[f];g.push({x:this.w*(q%h),y:this.h*Math.floor(q/h)})}this.states[a]=new c(g,d,this)};return a});
define("sprites/sprite",[],function(){function c(a,e,c,d,g,h,f){this.def=e;this.eng=a;this.x=c;this.y=d;this.h=g;this.state=null;this.active=!0;void 0===h&&(h=0);this.maxloops=h;this.updates=f}c.prototype.init=function(){if(void 0!==this.updates)for(var a=0;a<this.updates.length;a++)this.updates[a].init.call(this)};c.prototype.isActive=function(a){0<this.maxloops&&this.state.dur*this.maxloops<=a-this.epoch&&(this.active=!1);return this.active};c.prototype.setState=function(a,e){if(!(this.stateName===
a&&this.stateExt===e)){this.stateName=a;this.stateExt=e;void 0!==e&&this.def.states.hasOwnProperty(a+"_"+e)&&(a=a+"_"+e);if(!this.def.states.hasOwnProperty(a))throw"Bad sprite definition. Missing state: "+a;this.state=this.def.states[a];this.epoch=this.eng.getNow()}};c.prototype.stateName=function(){return this.stateName};c.prototype.hasState=function(a){return this.def.states.hasOwnProperty(a)};c.prototype.morphState=function(){};c.prototype.update=function(){if(void 0!==this.updates)for(var a=0;a<
this.updates.length&&this.updates[a].fn.call(this);a++);};c.prototype.draw=function(a,e,c,d){this.active&&this.state.draw(a,this.x-e-this.def.x,this.y-c-this.def.y-this.h,this.epoch,d)};return c});
define("input/keyboard",[],function(){return function(){var c=this;this.keymap={backspace:8,tab:9,enter:13,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,plus:187,comma:188,minus:189,period:190,shift:16,ctrl:17,alt:18,zero:48,one:49,two:50,three:51,four:52,five:53,six:54,seven:55,eight:56,nine:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,
num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,substract:109,decimal:110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};this.actions=[];this.keys=[];this.bind=function(a,e){c.actions[e]=0;c.keys[c.keymap[a]]=e};this.actionPressed=function(a){return!!c.actions[a]};window.addEventListener("keydown",function(a){var e=a.target.tagName;"keydown"!==a.type||("INPUT"===e||"TEXTAREA"===e)||(a.preventDefault(),
a=a.keyCode,(e=c.keys[a])&&(c.actions[e]=a))},!1);window.addEventListener("keyup",function(a){"keyup"===a.type&&(a.preventDefault(),(a=c.keys[a.keyCode])&&(c.actions[a]=0))},!1)}});define("input/mouse",[],function(){return function(c){var a=this;this.y=this.x=0;this.inputmap={mouse1:-1,mouse2:-3,wheelUp:-4,wheelDown:-5};c.addEventListener("mousemove",function(e){var j=c.getBoundingClientRect();a.x=e.clientX-j.left;a.y=e.clientY-j.top},!1)}});
define("util/preload",[],function(){function c(){this.batch=[];this.errorstate=!1}c.prototype.add=function(a,c,j){this.batch.push({file:a,tag:c,fnStore:j})};c.prototype.load=function(a,c,j){function d(d,b){return function(){f.errorstate||(h--,d.fnStore(b,d.tag),c(1-h/f.batch.length),0===h&&a())}}function g(){f.errorstate||(f.errorstate=!0,j())}var h=this.batch.length,f=this;c(0);for(var q=0;q<this.batch.length;q++){var i=this.batch[q],m=new Image;m.onload=d(i,m);m.onerror=g;m.src=i.file}};return c});
define("util/rnd",[],function(){var c=function(a,c){return a+Math.random()*(c-a+1)|0};return{rnd:c,fastRand:function(a,e){for(var j=[],d=1E4;0<d;d--)j.push(c(a,e));var g=0;return function(){g++;g===j.length&&(g=0);return j[g]}}}});define("util/url",[],function(){return{queryStringValue:function(c){return(c=RegExp("[?&]"+c+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(c[1].replace(/\+/g," "))}}});
define("util/all",["util/preload","util/rnd","util/url"],function(c,a,e){return{Preloader:c,rnd:a,Url:e}});define("plugins/sprite/bounce",[],function(){var c=function(){var a=this.state.jogPos(this.epoch,this.eng.getNow()),a=2*a-1,a=a*a;this.h=this.bounce_base+this.bounce_height*(1-a);return!0};return function(a){a.registerSpriteUpdater("bounce",c,function(){})}});
define("plugins/sprite/follow-mouse",[],function(){var c=function(){var a=this.eng.mouseWorldPos();this.x=a.x;this.y=a.y;return!0};return function(a){a.registerSpriteUpdater("follow_mouse",c,function(){})}});
define("plugins/sprite/link",[],function(){var c=function(){for(var a=this.link_to.length-1;0<=a;a--)this.link_to[a].sprite.x=this.x+this.link_to[a].x,this.link_to[a].sprite.y=this.y+this.link_to[a].y;return!0},a=function(){for(var a=this.link_to.length-1;0<=a;a--)this.link_to[a].sprite=this.eng.spriteMap[this.link_to[a].name]};return function(e){e.registerSpriteUpdater("link",c,a)}});
define("plugins/sprite/8way",[],function(){var c=function(){var a=this.x-this.oldx,c=2*(this.y-this.oldy);if(0===c)a=0===a?this.direction:0<a?"e":"w";else var d=a/c,a=0<=d?0.41421>d?0<c?"s":"n":2.4142<d?0<a?"e":"w":0<a?"se":"nw":-0.41421<d?0<c?"s":"n":-2.4142>d?0<a?"e":"w":0<a?"ne":"sw";this.direction=a;this.oldx=this.x;this.oldy=this.y;this.setState(this.stateName,this.direction);return!0},a=function(){this.direction="e"};return function(e){e.registerSpriteUpdater("8way",c,a)}});
define("plugins/default-plugins",["plugins/sprite/bounce","plugins/sprite/follow-mouse","plugins/sprite/link","plugins/sprite/8way"],function(c,a,e,j){return function(d){c(d);a(d);e(d);j(d)}});
define("polyfills/requestAnimationFrame",[],function(){for(var c=0,a=["ms","moz","webkit","o"],e=0;e<a.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[a[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[e]+"CancelAnimationFrame"]||window[a[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var e=(new Date).getTime(),g=Math.max(0,16-(e-c)),h=window.setTimeout(function(){a(e+g)},g);c=e+g;return h});window.cancelAnimationFrame||
(window.cancelAnimationFrame=function(a){clearTimeout(a)})});
define("snaps","tile sprites/spritedef sprites/sprite input/keyboard input/mouse util/all plugins/default-plugins polyfills/requestAnimationFrame".split(" "),function(c,a,e,j,d,g,h){function f(f,i,m){function u(){window.requestAnimationFrame(u);null!==r&&r.begin();b.now=+new Date;var a=b.now-b.lastFrameTime,c=1E3/60,a=Math.max(16,Math.floor(((a+12)/c|0)*c));x(a);y(b.ctx);if(b.dbgShowRegions&&void 0!==b.map){var l,e,d,f,k,g,a=b.map.tilewidth,c=b.map.tileheight/2;k=Math.floor((b.yoffset-c)/c);e=Math.floor((b.yoffset+
b.clientHeight-c+b.maxYOverdraw)/c)+1;d=Math.floor((b.xoffset+b.clientWidth-1)/a);g=Math.floor((b.xoffset-a/2-b.maxXOverdraw)/a);l=b.map.layers[0];l=Math.min(e,l.rows.length-1);for(e=Math.max(g,0);k<=l;k++){var i;k&1?(g=b.map.tilewidth/2,i="#f00"):(g=0,i="#0f0");for(f=d;f>=e;f--){b.ctx.strokeStyle=i;var h=Math.floor(-b.xoffset)+g+f*a,j=Math.floor(-b.yoffset)+k*c,m=b.map.tilewidth,p=b.map.tileheight;b.ctx.strokeRect(h,j,m,p);b.ctx.strokeStyle="#aaa";b.ctx.beginPath();b.ctx.moveTo(h,j+p/2);b.ctx.lineTo(h+
m/2,j);b.ctx.lineTo(h+m,j+p/2);b.ctx.lineTo(h+m/2,j+p);b.ctx.closePath();b.ctx.stroke()}}for(n=0;n<b.map.layers.length;n++){l=b.map.layers[n];for(k=0;k<l.rows.length;k++){d=l.rows[k];g=k&1?b.map.tilewidth/2:0;for(f=d.length-1;0<=f;f--)s(f+","+k,85+Math.floor(-b.xoffset)+g+f*a,55+Math.floor(-b.yoffset)+k*c)}}}b.dbgShowMouse&&(s("Screen: "+b.mouse.x+","+b.mouse.y,5,15),s("World: "+(b.mouse.x+b.xoffset)+","+(b.mouse.y+b.yoffset),5,30),s("Origin: "+b.xoffset+","+b.yoffset,5,45));b.dbgShowCounts&&s("Sprites: "+
b.sprites.length,5,b.clientHeight-15);b.lastFrameTime=b.now;null!==r&&r.end()}var b=this;this.util=g;var r=null;m.showFps&&late_require(["stats"],function(b){r=new b;b=r.domElement;b.style.position="absolute";b.style.left="0px";b.style.top="0px";document.body.appendChild(b)});this.dbgShowMouse=!!m.showMouse;this.dbgShowCounts=!!m.showCounts;this.dbgShowRegions=!!m.showRegions;this.imageCache={};this.spriteUpdaters={};this.timers={};b.now=+new Date;i=document.getElementById(i);this.clientWidth=i.clientWidth;
this.clientHeight=i.clientHeight;this.ctx=i.getContext("2d");this.keyboard=new j;this.mouse=new d(i);this.ctx.fillStyle="#000022";this.ctx.fillRect(0,0,i.clientWidth,i.clientHeight);this.game=f;i=f.map;this.maxyoffset=this.maxxoffset=this.minyoffset=this.minxoffset=0;void 0!==i&&(this.map=i,this.minxoffset=i.tilewidth/2,this.minyoffset=i.tileheight/2,this.maxxoffset=i.width*i.tilewidth-this.clientWidth,this.maxyoffset=i.height*(i.tileheight/2)-this.clientHeight);this.xoffset=this.minxoffset;this.yoffset=
this.maxyoffset;this.maxYOverdraw=this.maxXOverdraw=0;var y=b.game.draw,x=b.game.update;this.spriteDefs={};this.sprites=[];this.spriteMap={};this.lastFrameTime=+new Date;this.registerSpriteUpdater=function(a,c,l){b.spriteUpdaters[a]={fn:c,init:l}};h(this);if("function"===typeof b.game.onEngineStart)b.game.onEngineStart(this);f=new g.Preloader;if(void 0!==i)for(var m=function(b,a){a.image=b},n=0;n<i.tilesets.length;n++){var v=i.tilesets[n];f.add(v.image,v,m)}if("object"===typeof b.game.preloadImages){var i=
function(a,c){b.imageCache[c]=a},t;for(t in b.game.preloadImages)f.add(b.game.preloadImages[t],t,i)}if("object"===typeof b.game.spriteDefs){t=function(c,e){var l=b.game.spriteDefs[e],d=new a(c,l.w,l.h,l.x,l.y);b.spriteDefs[e]=d;for(var f in l.states)d.addState(f,l.states[f].seq,l.states[f].dur)};for(var w in b.game.spriteDefs)f.add(b.game.spriteDefs[w].path,w,t)}this.drawImage=function(a,c,l){b.ctx.drawImage(b.imageCache[a],c,l)};this.cls=function(){b.ctx.fillStyle="#000";b.ctx.fillRect(0,0,b.clientWidth,
b.clientHeight)};this.bindKeys=function(a){for(var c=0;c<a.length;c++){var l=a[c];b.keyboard.bind(l.key,l.action)}};f.load(function(){if(void 0!==b.map){var a,e,l,d;for(l=b.map.tilesets.length-1;0<=l;l--)d=b.map.tilesets[l],d.xspan=Math.floor(d.imagewidth/d.tilewidth),d.yspan=Math.floor(d.imageheight/d.tileheight);for(a=0;a<b.map.layers.length;a++){var f=b.map.layers[a];f.rows=[];var g=[];for(e=0;e<f.data.length;e++){var k=f.data[e];for(l=b.map.tilesets.length-1;0<=l&&!(d=b.map.tilesets[l],d.firstgid<=
k);l--);k-=d.firstgid;l=Math.floor(k/d.xspan);var k=k-d.xspan*l,i=d.tileheight-b.map.tileheight;b.maxXOverdraw=Math.max(d.tilewidth-b.map.tilewidth,b.maxXOverdraw);b.maxYOverdraw=Math.max(i,b.maxYOverdraw);g.push(new c(d.image,k*d.tilewidth,l*d.tileheight,d.tilewidth,d.tileheight,d.tilewidth-b.map.tilewidth,d.tileheight-b.map.tileheight));g.length>=f.width&&(f.rows.push(g),g=[])}}}if("function"===typeof b.game.onResourcesLoaded)b.game.onResourcesLoaded();setTimeout(u,0)},function(a){if("function"===
typeof b.game.onProgress)b.game.onProgress(a,b.ctx)},function(){b.game.onLoadError()});this.actioning=function(a){return b.keyboard.actionPressed(a)};this.scroll=function(a,c){b.xoffset+=a;b.yoffset+=c;b.xoffset<b.minxoffset?b.xoffset=b.minxoffset:b.xoffset>b.maxxoffset&&(b.xoffset=b.maxxoffset);b.yoffset<b.minyoffset?b.yoffset=b.minyoffset:b.yoffset>b.maxyoffset&&(b.yoffset=b.maxyoffset)};var s=function(a,c,d){b.ctx.fillStyle="black";b.ctx.font="bold 16px Arial";b.ctx.fillText(a,c+1,d);b.ctx.fillText(a,
c-1,d);b.ctx.fillText(a,c,d+1);b.ctx.fillText(a,c,d-1);b.ctx.fillStyle="white";b.ctx.fillText(a,c,d)};this.drawWorld=function(){var a=b.map.tilewidth,c=b.map.tileheight/2,d=Math.floor((b.yoffset-c)/c),e=Math.floor((b.yoffset+b.clientHeight-c+b.maxYOverdraw)/c)+1,f=Math.floor((b.xoffset+b.clientWidth-1)/a),g=Math.floor((b.xoffset-a/2-b.maxXOverdraw)/a);this.sprites.sort(function(b,a){return b.h-a.h});this.sprites.sort(function(b,a){return b.y-a.y});var k=0,i=0,h,j,m,n,p,q,r;for(p=0;p<b.map.layers.length;p++){n=
b.map.layers[p];q=Math.min(e,n.rows.length-1);r=Math.max(g,0);for(j=d;j<=q;j++){m=n.rows[j];i=j&1?b.map.tilewidth/2:0;for(h=f;h>=r;h--)m[h].draw(b.ctx,Math.floor(-b.xoffset)+i+h*a,Math.floor(-b.yoffset)+j*c);if(1==p)for(i=(j+2)*c;k<this.sprites.length&&i>=this.sprites[k].y;)b.sprites[k++].draw(b.ctx,b.xoffset,b.yoffset,b.now)}}};this.drawSprite=function(a){b.spriteMap[a].draw(b.ctx,b.xoffset,b.yoffset,b.now)};this.mouseScreenPos=function(){return{x:b.mouse.x,y:b.mouse.y}};this.mouseWorldPos=function(){return{x:b.mouse.x+
b.xoffset,y:b.mouse.y+b.yoffset}};this.nextName=1;this.spawnSprite=function(a,c,d,f,g,i,k){void 0===k&&(k={});var h=k.name;if(void 0===h)h="unnamed"+b.nextName,b.nextName++;else if(b.spriteMap.hasOwnProperty(h))throw"Warning: duplicate sprite name "+h;var a=b.spriteDefs[a],j=k.updates;if(void 0!==j)for(var j=Array(k.updates.length),m=0;m<k.updates.length;m++)j[m]=b.spriteUpdaters[k.updates[m]];f=new e(b,a,f,g,i,k.maxloops,j);f.setState(c,d);if(void 0!==k.opts)for(var n in k.opts)f[n]=k.opts[n];f.init();
b.sprites.push(f);b.spriteMap[h]=f};this.markTime=function(a,c){b.timers[a]=b.now+c};this.checkTimer=function(a,c){if(void 0===b.timers[a])return!1;var d=b.timers[a];if(0<b.now-d){if(void 0===c)delete b.timers[a];else{c=Math.max(1,c);do d+=c;while(d<b.now);b.timers[a]=d}return!0}return!1};this.moveSprite=function(a,c,d,e){a=b.spriteMap[a];a.x=c;a.y=d;void 0!==e&&(a.h=e)};this.updateSprites=function(){for(var a=[],c=0;c<b.sprites.length;c++){var d=b.sprites[c];d.isActive(b.now)?(d.update(),a.push(d)):
delete b.spriteMap[d.name]}b.sprites=a};this.getNow=function(){return b.now};this.resizeCanvas=function(){}}f.util=g;return f});
