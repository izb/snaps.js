define("snaps/tile",[],function(){function d(c,b,d,k,i,j,f){this.img=c;this.x=b;this.y=d;this.w=k;this.h=i;this.xoverdraw=j;this.yoverdraw=f}d.prototype.draw=function(c,b,d){c.drawImage(this.img,this.x,this.y,this.w,this.h,b-this.xoverdraw,d-this.yoverdraw,this.w,this.h)};return d});
define("snaps/sprites/spritedef",[],function(){function d(b,c,d){this.seq=b;this.dur=c;this.def=d}function c(b,c,d,i,j){this.states={};this.image=b;this.w=c;this.h=d;this.x=i;this.y=j}d.prototype.jogPos=function(b,c){var d;d=(c-b)%this.dur;return d/this.dur};d.prototype.draw=function(b,c,d,i,j){var f=this.def,i=this.seq[Math.floor(this.seq.length*this.jogPos(i,j))];b.drawImage(f.image,i.x,i.y,f.w,f.h,c,d,f.w,f.h)};c.prototype.addState=function(b,c,k){for(var i=[],j=Math.floor(this.image.width/this.w),
f=0;f<c.length;f++){var e=c[f];i.push({x:this.w*(e%j),y:this.h*Math.floor(e/j)})}this.states[b]=new d(i,k,this)};return c});
define("snaps/sprites/sprite",[],function(){function d(c,b,d,k,i,j,f){this.def=b;this.eng=c;this.x=d;this.y=k;this.h=i;this.state=null;this.active=!0;void 0===j&&(j=0);this.maxloops=j;this.updates=f}d.prototype.init=function(){if(void 0!==this.updates)for(var c=0;c<this.updates.length;c++)this.updates[c].init.call(this)};d.prototype.isActive=function(c){0<this.maxloops&&this.state.dur*this.maxloops<=c-this.epoch&&(this.active=!1);return this.active};d.prototype.setState=function(c,b){if(!(this.stateName===
c&&this.stateExt===b)){this.stateName=c;this.stateExt=b;void 0!==b&&(c=c+"_"+b);if(!this.def.states.hasOwnProperty(c))throw"Bad sprite definition. Missing state: "+c;this.state=this.def.states[c];this.epoch=this.eng.getNow()}};d.prototype.stateName=function(){return this.stateName};d.prototype.hasState=function(c){return this.def.states.hasOwnProperty(c)};d.prototype.morphState=function(){};d.prototype.update=function(){if(void 0!==this.updates)for(var c=0;c<this.updates.length&&this.updates[c].fn.call(this);c++);
};d.prototype.draw=function(c,b,d,k){this.active&&this.state.draw(c,this.x-b-this.def.x,this.y-d-this.def.y-this.h,this.epoch,k)};return d});
define("snaps/input/keyboard",[],function(){return function(){var d=this;this.keymap={backspace:8,tab:9,enter:13,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,plus:187,comma:188,minus:189,period:190,shift:16,ctrl:17,alt:18,zero:48,one:49,two:50,three:51,four:52,five:53,six:54,seven:55,eight:56,nine:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,
z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,substract:109,decimal:110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};this.actions=[];this.keys=[];this.bind=function(c,b){d.actions[b]=0;d.keys[d.keymap[c]]=b};this.actionPressed=function(c){return!!d.actions[c]};window.addEventListener("keydown",function(c){var b=c.target.tagName;"keydown"!==c.type||("INPUT"===b||"TEXTAREA"===b)||
(c.preventDefault(),c=c.keyCode,(b=d.keys[c])&&(d.actions[b]=c))},!1);window.addEventListener("keyup",function(c){"keyup"===c.type&&(c.preventDefault(),(c=d.keys[c.keyCode])&&(d.actions[c]=0))},!1)}});define("snaps/input/mouse",[],function(){return function(d){var c=this;this.y=this.x=0;this.inputmap={mouse1:-1,mouse2:-3,wheelUp:-4,wheelDown:-5};d.addEventListener("mousemove",function(b){var r=d.getBoundingClientRect();c.x=b.clientX-r.left;c.y=b.clientY-r.top},!1)}});
define("util/preload",[],function(){function d(){this.batch=[];this.errorstate=!1}d.prototype.add=function(c,b,d){this.batch.push({file:c,tag:b,fnStore:d})};d.prototype.load=function(c,b,d){function k(a,d){return function(){f.errorstate||(j--,a.fnStore(d,a.tag),b(1-j/f.batch.length),0===j&&c())}}function i(){f.errorstate||(f.errorstate=!0,d())}var j=this.batch.length,f=this;b(0);for(var e=0;e<this.batch.length;e++){var l=this.batch[e],n=new Image;n.onload=k(l,n);n.onerror=i;n.src=l.file}};return d});
define("snaps/plugins/sprite/bounce",["jquery"],function(d){var c=function(){var b=this.state.jogPos(this.epoch,this.eng.getNow()),b=2*b-1,b=b*b;this.h=this.bounce_base+this.bounce_height*(1-b);return!0};return function(b){b.registerSpriteUpdater("bounce",c,d.noop)}});define("snaps/plugins/sprite/follow-mouse",["jquery"],function(d){var c=function(){var b=this.eng.mouseWorldPos();this.x=b.x;this.y=b.y;return!0};return function(b){b.registerSpriteUpdater("follow_mouse",c,d.noop)}});
define("snaps/plugins/sprite/link",[],function(){var d=function(){for(var b=this.link_to.length-1;0<=b;b--)this.link_to[b].x=this.x,this.link_to[b].y=this.y;return!0},c=function(){for(var b=this.link_to.length-1;0<=b;b--)this.link_to[b]=this.eng.spriteMap[this.link_to[b]]};return function(b){b.registerSpriteUpdater("link",d,c)}});
define("snaps/plugins/sprite/8way",[],function(){var d=function(){var b=this.x-this.oldx,c=2*(this.y-this.oldy);if(0===c)b=0===b?this.direction:0<b?"e":"w";else var d=b/c,b=0<=d?0.5>d?0<c?"s":"n":2<d?0<b?"e":"w":0<b?"se":"nw":-0.5<d?0<c?"s":"n":-2>d?0<b?"e":"w":0<b?"ne":"sw";this.direction=b;this.oldx=this.x;this.oldy=this.y;this.setState(this.stateName,this.direction);return!0},c=function(){this.direction="e"};return function(b){b.registerSpriteUpdater("8way",d,c)}});
define("snaps/plugins/default-plugins",["snaps/plugins/sprite/bounce","snaps/plugins/sprite/follow-mouse","snaps/plugins/sprite/link","snaps/plugins/sprite/8way"],function(d,c,b,r){return function(k){d(k);c(k);b(k);r(k)}});
define("polyfills/requestAnimationFrame",["jquery"],function(){for(var d=0,c=["ms","moz","webkit","o"],b=0;b<c.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[c[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c[b]+"CancelAnimationFrame"]||window[c[b]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(c){var b=(new Date).getTime(),i=Math.max(0,16-(b-d)),j=window.setTimeout(function(){c(b+i)},i);d=b+i;return j});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(b){clearTimeout(b)})});
define("snaps/main","snaps/tile snaps/sprites/spritedef snaps/sprites/sprite snaps/input/keyboard snaps/input/mouse util/preload snaps/plugins/default-plugins polyfills/requestAnimationFrame".split(" "),function(d,c,b,r,k,i,j){return function(f,e,l){function n(){window.requestAnimationFrame(n);null!==t&&t.begin();a.now=+new Date;var b=a.now-a.lastFrameTime,c=1E3/60,b=Math.max(16,Math.floor(((b+12)/c|0)*c));y(b);z(a.ctx);var d,h,f,e,g,i,b=a.map.tilewidth,c=a.map.tileheight/2;g=Math.floor((a.yoffset-
c)/c);h=Math.floor((a.yoffset+a.clientHeight-c+a.maxYOverdraw)/c)+1;f=Math.floor((a.xoffset+a.clientWidth-1)/b);i=Math.floor((a.xoffset-b/2-a.maxXOverdraw)/b);if(a.dbgShowRegions){d=a.map.layers[0];d=Math.min(h,d.rows.length-1);for(h=Math.max(i,0);g<=d;g++){var j;g&1?(i=a.map.tilewidth/2,j="#f00"):(i=0,j="#0f0");for(e=f;e>=h;e--){a.ctx.strokeStyle=j;var k=Math.floor(-a.xoffset)+i+e*b,l=Math.floor(-a.yoffset)+g*c,s=a.map.tilewidth,p=a.map.tileheight;a.ctx.strokeRect(k,l,s,p);a.ctx.strokeStyle="#aaa";
a.ctx.beginPath();a.ctx.moveTo(k,l+p/2);a.ctx.lineTo(k+s/2,l);a.ctx.lineTo(k+s,l+p/2);a.ctx.lineTo(k+s/2,l+p);a.ctx.closePath();a.ctx.stroke()}}for(q=0;q<a.map.layers.length;q++){d=a.map.layers[q];for(g=0;g<d.rows.length;g++){f=d.rows[g];i=g&1?a.map.tilewidth/2:0;for(e=f.length-1;0<=e;e--)u(e+","+g,85+Math.floor(-a.xoffset)+i+e*b,55+Math.floor(-a.yoffset)+g*c)}}}a.dbgShowMouse&&(u("Screen: "+a.mouse.x+","+a.mouse.y,5,15),u("World: "+(a.mouse.x+a.xoffset)+","+(a.mouse.y+a.yoffset),5,30),u("Origin: "+
a.xoffset+","+a.yoffset,5,45));a.dbgShowCounts&&u("Sprites: "+a.sprites.length,5,a.clientHeight-15);a.lastFrameTime=a.now;null!==t&&t.end()}var a=this,t=null;l.showFps&&late_require(["stats"],function(a){t=new a;a=t.domElement;a.style.position="absolute";a.style.left="0px";a.style.top="0px";document.body.appendChild(a)});this.dbgShowMouse=!!l.showMouse;this.dbgShowCounts=!!l.showCounts;this.dbgShowRegions=!!l.showRegions;this.imageCache={};this.spriteUpdaters={};this.timers={};a.now=+new Date;e=document.getElementById(e);
this.clientWidth=e.clientWidth;this.clientHeight=e.clientHeight;this.ctx=e.getContext("2d");this.keyboard=new r;this.mouse=new k(e);this.ctx.fillStyle="#000022";this.ctx.fillRect(0,0,e.clientWidth,e.clientHeight);this.game=f;this.map=e=f.map;this.minxoffset=e.tilewidth/2;this.minyoffset=e.tileheight/2;this.maxxoffset=e.width*e.tilewidth-this.clientWidth;this.maxyoffset=e.height*(e.tileheight/2)-this.clientHeight;this.xoffset=this.minxoffset;this.yoffset=this.maxyoffset;this.maxYOverdraw=this.maxXOverdraw=
0;var z=a.game.draw,y=a.game.update;this.spriteDefs={};this.sprites=[];this.spriteMap={};this.lastFrameTime=+new Date;this.registerSpriteUpdater=function(b,c,d){a.spriteUpdaters[b]={fn:c,init:d}};j(this);if("function"===typeof a.game.onEngineStart)a.game.onEngineStart(this);for(var f=new i,l=function(a,b){b.image=a},q=0;q<e.tilesets.length;q++){var w=e.tilesets[q];f.add(w.image,w,l)}if("object"===typeof a.game.preloadImages){var e=function(b,c){a.imageCache[c]=b},v;for(v in a.game.preloadImages)f.add(a.game.preloadImages[v],
v,e)}if("object"===typeof a.game.spriteDefs){v=function(b,d){var m=a.game.spriteDefs[d],h=new c(b,m.w,m.h,m.x,m.y);a.spriteDefs[d]=h;for(var e in m.states)h.addState(e,m.states[e].seq,m.states[e].dur)};for(var x in a.game.spriteDefs)f.add(a.game.spriteDefs[x].path,x,v)}this.drawImage=function(b,c,d){a.ctx.drawImage(a.imageCache[b],c,d)};this.cls=function(){a.ctx.fillStyle="#000";a.ctx.fillRect(0,0,a.clientWidth,a.clientHeight)};this.bindKeys=function(b){for(var c=0;c<b.length;c++){var d=b[c];a.keyboard.bind(d.key,
d.action)}};f.load(function(){var b,c,m,h;for(m=a.map.tilesets.length-1;0<=m;m--)h=a.map.tilesets[m],h.xspan=Math.floor(h.imagewidth/h.tilewidth),h.yspan=Math.floor(h.imageheight/h.tileheight);for(b=0;b<a.map.layers.length;b++){var e=a.map.layers[b];e.rows=[];var f=[];for(c=0;c<e.data.length;c++){var g=e.data[c];for(m=a.map.tilesets.length-1;0<=m&&!(h=a.map.tilesets[m],h.firstgid<=g);m--);g-=h.firstgid;m=Math.floor(g/h.xspan);var g=g-h.xspan*m,i=h.tileheight-a.map.tileheight;a.maxXOverdraw=Math.max(h.tilewidth-
a.map.tilewidth,a.maxXOverdraw);a.maxYOverdraw=Math.max(i,a.maxYOverdraw);f.push(new d(h.image,g*h.tilewidth,m*h.tileheight,h.tilewidth,h.tileheight,h.tilewidth-a.map.tilewidth,h.tileheight-a.map.tileheight));f.length>=e.width&&(e.rows.push(f),f=[])}}if("function"===typeof a.game.onResourcesLoaded)a.game.onResourcesLoaded();setTimeout(n,0)},function(b){if("function"===typeof a.game.onProgress)a.game.onProgress(b,a.ctx)},function(){a.game.onLoadError()});this.actioning=function(b){return a.keyboard.actionPressed(b)};
this.scroll=function(b,c){a.xoffset+=b;a.yoffset+=c;a.xoffset<a.minxoffset?a.xoffset=a.minxoffset:a.xoffset>a.maxxoffset&&(a.xoffset=a.maxxoffset);a.yoffset<a.minyoffset?a.yoffset=a.minyoffset:a.yoffset>a.maxyoffset&&(a.yoffset=a.maxyoffset)};var u=function(b,c,d){a.ctx.fillStyle="black";a.ctx.font="bold 16px Arial";a.ctx.fillText(b,c+1,d);a.ctx.fillText(b,c-1,d);a.ctx.fillText(b,c,d+1);a.ctx.fillText(b,c,d-1);a.ctx.fillStyle="white";a.ctx.fillText(b,c,d)};this.drawWorld=function(){var b=a.map.tilewidth,
c=a.map.tileheight/2,d=Math.floor((a.yoffset-c)/c),e=Math.floor((a.yoffset+a.clientHeight-c+a.maxYOverdraw)/c)+1,f=Math.floor((a.xoffset+a.clientWidth-1)/b),i=Math.floor((a.xoffset-b/2-a.maxXOverdraw)/b);this.sprites.sort(function(a,b){return a.h-b.h});this.sprites.sort(function(a,b){return a.y-b.y});var g=0,j=0,k,l,n,s,p,q,r;for(p=0;p<a.map.layers.length;p++){s=a.map.layers[p];q=Math.min(e,s.rows.length-1);r=Math.max(i,0);for(l=d;l<=q;l++){n=s.rows[l];j=l&1?a.map.tilewidth/2:0;for(k=f;k>=r;k--)n[k].draw(a.ctx,
Math.floor(-a.xoffset)+j+k*b,Math.floor(-a.yoffset)+l*c);if(1==p)for(j=(l+2)*c;g<this.sprites.length&&j>=this.sprites[g].y;)a.sprites[g++].draw(a.ctx,a.xoffset,a.yoffset,a.now)}}};this.mouseScreenPos=function(){return{x:a.mouse.x,y:a.mouse.y}};this.mouseWorldPos=function(){return{x:a.mouse.x+a.xoffset,y:a.mouse.y+a.yoffset}};this.nextName=1;this.spawnSprite=function(c,d,e,h,f,i,g){void 0===g&&(g={});void 0===g.name&&(g.name="unnamed"+a.nextName,a.nextName++);var c=a.spriteDefs[c],j=g.updates;if(void 0!==
j)for(var j=Array(g.updates.length),k=0;k<g.updates.length;k++)j[k]=a.spriteUpdaters[g.updates[k]];h=new b(a,c,h,f,i,g.maxloops,j);h.setState(d,e);if(void 0!==g.opts)for(var l in g.opts)h[l]=g.opts[l];h.init();a.sprites.push(h);a.spriteMap[g.name]=h};this.markTime=function(b,c){a.timers[b]=a.now+c};this.checkTimer=function(b,c){if(void 0===a.timers[b])return!1;var d=a.timers[b];if(0<a.now-d){if(void 0===c)delete a.timers[b];else{c=Math.max(1,c);do d+=c;while(d<a.now);a.timers[b]=d}return!0}return!1};
this.moveSprite=function(b,c,d,e){b=a.spriteMap[b];b.x=c;b.y=d;void 0!==e&&(b.h=e)};this.updateSprites=function(){for(var b=[],c=0;c<a.sprites.length;c++){var d=a.sprites[c];d.isActive(a.now)?(d.update(),b.push(d)):delete a.spriteMap[d.name]}a.sprites=b};this.getNow=function(){return a.now};this.resizeCanvas=function(){}}});
