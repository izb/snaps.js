<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: plugins/layer/ground-sprites.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: plugins/layer/ground-sprites.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/*global define*/
define(['sprites/sprite',
        'util/uid'],

function(Sprite, uid) {

    'use strict';

    var sn;

    /* A layer that holds flat sprites that are intended to be drawn after the ground, but
     * before the buildings and other sprites. */

    /**
     * @param {Object} opts Parameters for customizing the layer.
     */
    function GroundSprites(layerName, opts) {
        this.opts = opts||{};
        this.name = layerName;
        this.sprites = [];
        this.spriteMap = {};
    }

    GroundSprites.prototype.update = function(now) {
    };

    GroundSprites.prototype.draw = function(ctx, now) {

        var map = sn.map;
        /* TODO: Sort sprites if sprites are not static. */
        for (var i = this.sprites.length - 1; i >= 0; i--) {
            this.sprites[i].draw(ctx, map.xoffset, map.yoffset, now);
        }
    };

    GroundSprites.prototype.purgeAll = function() {
        for (var i = this.sprites.length - 1; i >= 0; i--) {
            this.sprites[i].onRemove();
        }
        this.sprites = [];
        this.spriteMap = {};
    };

    /**
     * Spawn a new sprite on the ground plane
     * @param defName The name of the sprite definition to use. These are
     * set up in your game's spriteDefs data.
     * @param stateName The initial state. This too is defined in the
     * sprite's definition, in your game's spriteDefs data.
     * @param {Function/Number} x The world x coordinate. If a function, it should take
     * no parameters and return a number.
     * @param {Function/Number} y The world y coordinate. If a function, it should take
     * no parameters and return a number.
     * @param {Function/Number} h The height off the ground. If a function, it should take
     * no parameters and return a number.
     * @param Optional parameter object, which can contain:
     * 'id' if you want to be able to find your sprite again.
     * 'maxloops' if your sprite should remove itself from the world
     * after it's looped around its animation a certain number of times. Can be a function, like
     * the world position parameters.
     * Normally you'd set this to 1 for things like explosions.
     * 'update' An array of functions that are called in-order for this
     * sprite.
     * 'endCallback' A function called when the sprite naturally ends
     */
    GroundSprites.prototype.spawnSprite = function(defName, stateName, stateExt, x, y, opts) {

        opts = opts||{};

        if (opts.id===undefined) {
            opts.id = uid();
        } else {
            if(sn.spriteMap.hasOwnProperty(opts.id)) {
                throw "Error: duplicate sprite id " + opts.id;
            }
        }

        var s = Sprite.construct(sn, defName, stateName, stateExt, x, y, 0, opts);

        /* TODO: If static sprites are set, insert at a sorted screen y position. */

        this.sprites.push(s);
        this.spriteMap[opts.id] = s;

        return s;
    };

    /* TODO: Spawn sprite on tile. */

    return function(snaps) {
        sn = snaps;
        sn.registerLayerPlugin('ground-sprites', GroundSprites, function(){});
    };

});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="pathfinder.html">ai/pathfinder</a></li><li><a href="tween.html">animate/tween</a></li></ul><h3>Classes</h3><ul><li><a href="pathfinder.PathFinder.html">PathFinder</a></li></ul><h3>Global</h3><ul><li><a href="global.html#fastRand">fastRand</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Tue Apr 30 2013 22:41:04 GMT+0100 (BST)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
