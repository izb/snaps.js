define("sprites/spritedef",[],function(){function a(a,b,d){this.seq=a;this.dur=b;this.def=d}function d(a,b,d,k,g){this.states={};this.image=a;this.w=b;this.h=d;this.x=k;this.y=g}a.prototype.jogPos=function(a,b){var d;d=(b-a)%this.dur;return d/this.dur};a.prototype.draw=function(a,b,d,k,g,h){var l=this.def;k=this.seq[h?this.seq.length-1:Math.floor(this.seq.length*this.jogPos(k,g))];a.drawImage(l.image,k[0],k[1],l.w,l.h,b,d,l.w,l.h)};d.prototype.addState=function(c,b,d){for(var k=[],g=Math.floor(this.image.width/
this.w),h=0;h<b.length;h++){var l=b[h];k.push([this.w*(l%g),this.h*Math.floor(l/g)])}this.states[c]=new a(k,d,this)};return d});
define("sprites/sprite",[],function(){function a(a,c,b,e,k,g){g=g||{};this.def=c;this.sn=a;this.x="function"===typeof b?b():b;this.y="function"===typeof e?e():e;this.h="function"===typeof k?k():k;this.state=null;this.active=!0;this.maxloops=void 0===g.maxloops?0:"function"===typeof g.maxloops?g.maxloops():g.maxloops;this.updates=g.updates;this.id=g.id;this.endCallback=g.endCallback;this.collider=g.collider;this.autoRemove=g.autoRemove;void 0===this.autoRemove&&(this.autoRemove=!0);this.phaserData=
g.phaserData;this.collisionPoint=[0,0];this.quantizedHeight=!!g.quantizedHeight}a.prototype.init=function(){if(void 0!==this.updates)for(var a=0;a<this.updates.length;a++)this.updates[a].init(this)};a.prototype.maxDuration=function(){return 0===this.maxloops?0:this.state.dur*this.maxloops};a.prototype.isActive=function(a){this.active&&(0<this.maxloops&&this.state.dur*this.maxloops<=a-this.epoch)&&(this.active=!1,void 0!==this.endCallback&&this.autoRemove&&this.endCallback());return this.active||!this.autoRemove};
a.prototype.setState=function(a,c){this.active=!0;if(!(this.stateName===a&&this.stateExt===c)){this.stateName=a;this.stateExt=c;void 0!==c&&this.def.states.hasOwnProperty(a+"_"+c)&&(a=a+"_"+c);if(!this.def.states.hasOwnProperty(a))throw"Bad sprite definition. Missing state: "+a;this.state=this.def.states[a];this.epoch=this.sn.getNow()}};a.prototype.stateName=function(){return this.stateName};a.prototype.hasState=function(a){return this.def.states.hasOwnProperty(a)};a.prototype.morphState=function(a){};
a.prototype.update=function(a){if(void 0!==this.updates)for(var c=0;c<this.updates.length;c++){var b=this.updates[c],e=void 0===b.phaser?!0:b.phaser.phase(this,a);if(!b.update(a,e))break}};a.prototype.drawAt=function(a,c,b,e){(this.active||!this.autoRemove)&&this.state.draw(a,c,b,this.epoch,e,!this.active&&!this.autoRemove)};a.prototype.moveTo=function(a,c,b,e){void 0!==b&&(b-=this.h);this.move(a-this.x,c-this.y,b,e)};a.prototype.move=function(a,c,b,e){if(a||c||b){e=void 0===e?!0:e;var k;e&&void 0!==
this.collider?(k=this.collider.test(this.x,this.y,a,c,this.h,this.collisionPoint),this.x=this.collisionPoint[0],this.y=this.collisionPoint[1]):(this.x+=a,this.y+=c);this.directionx=this.x+a;this.directiony=this.y+c;void 0!==b&&(this.h=e&&1>k&&!this.quantizedHeight?this.h+b*k:this.h+b)}};a.prototype.setDirection=function(a,c){this.directionx=a;this.directiony=c};a.prototype.draw=function(a,c,b,e){this.drawAt(a,this.x-c-this.def.x|0,this.y-b-this.def.y-this.h|0,e)};a.prototype.onRemove=function(){if(void 0!==
this.updates)for(var a=0;a<this.updates.length;a++)this.updates[a].onSpriteRemoved()};return a});define("util/js",[],function(){HTMLCanvasElement.prototype.relCoords=function(a,d,c){var b=this.getBoundingClientRect();c[0]=a-b.left-window.pageXOffset;c[1]=d-b.top-window.pageYOffset};return{copyProps:function(a,d){for(var c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d},clone:function(a){var d={},c;for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);return d}}});
define("sprites/composite",["util/js","sprites/sprite"],function(a,d){function c(a,b,c,d,e){this.sn=a;this.x=b;this.y=c;this.endCallback=e;this.active=!0;this.sprites=[]}var b=a.copyProps,e=a.clone;c.prototype.init=function(){};c.prototype.addSprite=function(a,c,h,l,n,m){void 0===m&&(m={});a=this.sn.spriteDefs[a];var q=m.updates;if(void 0!==q)for(var q=Array(m.updates.length),v=0;v<m.updates.length;v++)q[v]=new this.sn.spriteUpdaters[m.updates[v].name],b(m.updates[v],q[v]);m=e(m);m.updates=q;h=new d(this.sn,
a,h,l,n,m);h.setState(c);if(void 0!==m.opts)for(var y in m.opts)h[y]=m.opts[y];h.init();this.sprites.push(h);return h};c.prototype.isActive=function(a){if(!this.active)return!1;for(var b=!1,c=this.sprites.length-1;0<=c;c--)this.sprites[c].isActive(a)?b=!0:this.sprites.splice(c,1);this.active=b;!this.active&&void 0!==this.endCallback&&this.endCallback();return b};c.prototype.update=function(a,b){for(var c=this.sprites.length-1;0<=c;c--)void 0!==b&&b(this.sprites[c],a),this.sprites[c].update()};c.prototype.draw=
function(a,b,c,d){if(this.active){b=this.x-b;c=this.y-c;for(var e=0;e<this.sprites.length;e++){var m=this.sprites[e];m.isActive(d)&&m.drawAt(a,b+m.x-m.def.y,c+m.y-m.h-m.def.y,d)}}};c.prototype.onRemove=function(){for(var a=this.sprites.length-1;0<=a;a--)this.sprites[a].onRemove()};return c});
define("input/keyboard",[],function(){return function(){var a=this;this.keymap={backspace:8,tab:9,enter:13,pause:19,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,ins:45,del:46,plus:187,comma:188,minus:189,period:190,shift:16,ctrl:17,alt:18,zero:48,one:49,two:50,three:51,four:52,five:53,six:54,seven:55,eight:56,nine:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,
num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,multiply:106,add:107,substract:109,decimal:110,divide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};this.actions=[];this.keys=[];this.bind=function(d,c){a.actions[c]=0;a.keys[a.keymap[d]]=c};this.actionPressed=function(d){return!!a.actions[d]};window.addEventListener("keydown",function(d){var c=d.target.tagName;"keydown"!==d.type||("INPUT"===c||"TEXTAREA"===c)||(d.preventDefault(),
d=d.keyCode,(c=a.keys[d])&&(a.actions[c]=d))},!1);window.addEventListener("keyup",function(d){"keyup"===d.type&&(d.preventDefault(),(d=a.keys[d.keyCode])&&(a.actions[d]=0))},!1)}});define("input/mouse",[],function(){return function(a){var d=this;this.y=this.x=0;this.inputmap={mouse1:-1,mouse2:-3,wheelUp:-4,wheelDown:-5};a.addEventListener("mousemove",function(c){var b=a.getBoundingClientRect();d.x=c.clientX-b.left;d.y=c.clientY-b.top},!1)}});
define("util/preload",[],function(){function a(){this.batch=[];this.errorstate=!1}a.prototype.add=function(a,c,b){this.batch.push({file:a,tag:c,fnStore:b})};a.prototype.load=function(a,c,b){function e(b,e){return function(){h.errorstate||(g--,b.fnStore(e,b.tag),c(1-g/h.batch.length),0===g&&a())}}function k(a){h.errorstate||(h.errorstate=!0,b())}var g=this.batch.length,h=this;c(0);for(var l=0;l<this.batch.length;l++){var n=this.batch[l],m=new Image;m.onload=e(n,m);m.onerror=k;m.src=n.file}};return a});
define("util/rnd",[],function(){var a=function(a,c){return a+Math.random()*(c-a+1)|0},d=function(a,c){return a+Math.random()*(c-a+1)},c=function(a,c,d,g){var h=[];for(d=d||1E4;0<d;d--)h.push(g(a,c));var l=0;return function(){l++;l===h.length&&(l=0);return h[l]}};return{rnd:a,rndFloat:d,fastRand:function(b,d,k){return c(b,d,k,a)},fastRandFloat:function(a,e,k){return c(a,e,k,d)}}});
define("util/bitmap",[],function(){return{imageToRData:function(a){var d=a.width,c=a.height,b=document.createElement("canvas");b.height=c;b.width=d;b=b.getContext("2d");b.drawImage(a,0,0);a=b.getImageData(0,0,d,c).data;d=Array(a.length/4);for(c=0;c<d.length;c++)d[c]=a[4*c];return d}}});
define("util/debug",[],function(){return{debugText:function(a,d,c,b){a.fillStyle="black";a.font="bold 16px Arial";a.fillText(d,c+1,b);a.fillText(d,c-1,b);a.fillText(d,c,b+1);a.fillText(d,c,b-1);a.fillStyle="white";a.fillText(d,c,b)}}});define("util/uid",[],function(){var a=1;return function(){return"id"+a++}});define("util/url",[],function(){return{queryStringValue:function(a){return(a=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search))&&decodeURIComponent(a[1].replace(/\+/g," "))}}});
define("util/all","util/preload util/rnd util/bitmap util/debug util/js util/uid util/url".split(" "),function(a,d,c,b,e,k,g){return{Preloader:a,rnd:d,js:e,uid:k,debug:b,Bitmap:c,Url:g}});
define("map/tile",[],function(){function a(a,c,b,e,k,g,h,l,n){this.img=a;this.x=c;this.y=b;this.w=e;this.h=k;this.xoverdraw=g;this.yoverdraw=h;this.defaultProps=l||{};this.properties=n||{}}a.prototype.draw=function(a,c,b){a.drawImage(this.img,this.x,this.y,this.w,this.h,c-this.xoverdraw,b-this.yoverdraw,this.w,this.h)};a.prototype.getProperty=function(a){if(this.properties.hasOwnProperty(a))return this.properties[a];if(this.defaultProps.hasOwnProperty(a))return this.defaultProps[a]};return a});
define("map/staggered-isometric",["map/tile","util/bitmap","util/debug","util/js"],function(a,d,c,b){function e(a,b,c,d){this.data=a;this.hitTests=b;this.maxYOverdraw=this.maxXOverdraw=0;this.clientWidth=c;this.clientHeight=d;this.minxoffset=this.data.tilewidth/2;this.minyoffset=this.data.tileheight/2;this.maxxoffset=this.data.width*this.data.tilewidth-this.clientWidth-1;this.maxyoffset=this.data.height*(this.data.tileheight/2)-this.clientHeight-1;this.xoffset=this.minxoffset;this.yoffset=this.maxyoffset}
var k=c.debugText,g=[0,0];e.prototype.primePreloader=function(a){for(var b=this.data,c=this,e=function(a,b){b.image=a},g=0;g<b.tilesets.length;g++){var k=b.tilesets[g];a.add(k.image,k,e)}var e=function(a,e){if(a.width!==b.tilewidth||a.height!==b.tileheight)throw"Hit test image "+e+" does not match map tile size";"hit"===e&&(c.hitTest=d.imageToRData(a))},h;for(h in this.hitTests)a.add(this.hitTests[h],h,e)};var h=function(a){if(void 0===a)return a;for(var b in a)"height"===b&&"string"===typeof a[b]&&
(a[b]=parseInt(a[b],10));return a};e.prototype.resolveTiles=function(){var b,c,d,e,g,k=this.data;for(d=k.tilesets.length-1;0<=d;d--)e=k.tilesets[d],e.xspan=Math.floor(e.imagewidth/e.tilewidth),e.yspan=Math.floor(e.imageheight/e.tileheight);for(b=0;b<k.layers.length;b++){var r=k.layers[b];r.rows=[];var s=[];for(c=0;c<r.data.length;c++){var w=r.data[c];if(0===w)s.push(null);else{for(d=k.tilesets.length-1;0<=d&&!(e=k.tilesets[d],e.firstgid<=w);d--);d=w-e.firstgid;var w=Math.floor(d/e.xspan),p=d-e.xspan*
w;g=e.tileheight-k.tileheight;this.maxXOverdraw=Math.max(e.tilewidth-k.tilewidth,this.maxXOverdraw);this.maxYOverdraw=Math.max(g,this.maxYOverdraw);g=void 0;void 0!==e.tileproperties&&e.tileproperties.hasOwnProperty(d)&&(g=e.tileproperties[d]);s.push(new a(e.image,p*e.tilewidth,w*e.tileheight,e.tilewidth,e.tileheight,e.tilewidth-k.tilewidth,e.tileheight-k.tileheight,h(e.properties),h(g)))}s.length>=r.width&&(r.rows.push(s),s=[])}}};e.prototype.drawDebugRegions=function(a){var b=this.data,c,e,d,g,
h,s,w=b.tilewidth,p=b.tileheight/2;h=Math.floor((this.yoffset-p)/p);e=Math.floor((this.yoffset+this.clientHeight-p+this.maxYOverdraw)/p)+1;d=Math.floor((this.xoffset+this.clientWidth-1)/w);s=Math.floor((this.xoffset-w/2-this.maxXOverdraw)/w);c=b.layers[0];c=Math.min(e,c.rows.length-1);for(e=Math.max(s,0);h<=c;h++){var t;h&1?(s=b.tilewidth/2,t="#f00"):(s=0,t="#0f0");for(g=d;g>=e;g--){a.strokeStyle=t;var u=Math.floor(-this.xoffset)+s+g*w,f=Math.floor(-this.yoffset)+h*p,x=b.tilewidth,z=b.tileheight;
a.strokeRect(u,f,x,z);a.strokeStyle="#aaa";a.beginPath();a.moveTo(u,f+z/2);a.lineTo(u+x/2,f);a.lineTo(u+x,f+z/2);a.lineTo(u+x/2,f+z);a.closePath();a.stroke()}}c=b.layers[0];for(h=0;h<c.rows.length;h++){d=c.rows[h];s=h&1?b.tilewidth/2:0;for(g=d.length-1;0<=g;g--)k(a,g+","+h,85+Math.floor(-this.xoffset)+s+g*w,55+Math.floor(-this.yoffset)+h*p)}};e.prototype.scrollTo=function(a,b){this.xoffset=a;this.yoffset=b;this.xoffset<this.minxoffset?this.xoffset=this.minxoffset:this.xoffset>this.maxxoffset&&(this.xoffset=
this.maxxoffset);this.yoffset<this.minyoffset?this.yoffset=this.minyoffset:this.yoffset>this.maxyoffset&&(this.yoffset=this.maxyoffset)};e.prototype.scroll=function(a,b){this.scrollTo(this.xoffset+a,this.yoffset+b)};e.prototype.getWorldEdges=function(){return{le:this.minxoffset,te:this.minyoffset,re:this.maxxoffset+this.clientWidth,be:this.maxyoffset+this.clientHeight}};e.prototype.worldToTilePos=function(a,b,c){var e=this.data,d=e.tilewidth,e=e.tileheight;a|=0;b|=0;255!==this.hitTest[Math.floor(a%
d)+Math.floor(b%e)*d]?(c[0]=((a+d)/d|0)-1,c[1]=2*(((b+e)/e|0)-1)):(c[0]=((a+d/2)/d|0)-1,c[1]=2*((b+e/2)/e|0)-1)};e.prototype.getTilePropAtWorldPos=function(a,b,c){this.worldToTilePos(b,c,g);b=this.data.layers;var e;for(c=b.length-1;0<=c;c--)if(e=b[c].rows,void 0!==e&&(0<=g[1]&&g[1]<e.length)&&(e=e[g[1]][g[0]]))if(e=e.getProperty(a),void 0!==e)return e};e.prototype.screenToTilePos=function(a,b,c){this.worldToTilePos(a+this.xoffset,b+this.yoffset,c)};e.prototype.screenToWorldPos=function(a,b,c){c[0]=
a+this.xoffset;c[1]=b+this.yoffset};e.prototype.worldToScreenPos=function(a,b,c){c[0]=a-this.xoffset;c[1]=b-this.yoffset};e.prototype.insertLayer=function(a,b){this.data.layers.splice(a,0,b)};e.prototype.updateLayers=function(a){for(var b=this.data,c=0;c<b.layers.length;c++){var e=b.layers[c];e.hasOwnProperty("update")&&e.update(a)}};e.prototype.drawWorld=function(a,b,c){var e=this.data,d=e.tilewidth,g=e.tileheight/2,k=Math.floor((this.yoffset-g)/g),h=Math.floor((this.yoffset+this.clientHeight-g+
this.maxYOverdraw)/g)+1,w=Math.floor((this.xoffset+this.clientWidth-1)/d),p=Math.floor((this.xoffset-d/2-this.maxXOverdraw)/d);c.sort(function(a,b){var c=a.y-b.y;return 0!==c?c:a.h-b.h});var t=0,u=0,f,x,z,A,B,C,D,F=e.layers.length-1;for(B=0;B<e.layers.length;B++)if(A=e.layers[B],"draw"in A)A.draw(a,b);else if(A.visible){C=Math.min(h,A.rows.length-1);D=Math.max(p,0);for(x=k;x<=C;x++){z=A.rows[x];u=x&1?e.tilewidth/2:0;for(f=w;f>=D;f--){var E=z[f];null!==E&&E.draw(a,Math.floor(-this.xoffset)+u+f*d,Math.floor(-this.yoffset)+
x*g)}if(B===F)for(u=(x+2)*g;t<c.length&&u>=c[t].y;)c[t++].draw(a,this.xoffset,this.yoffset,b)}}};return e});define("plugins/sprite/bounce",[],function(){function a(){}var d;a.prototype.update=function(a,b){var e=this.sprite,k=e.state.jogPos(e.epoch,d.getNow()),k=2*k-1,k=k*k;e.h=this.bounce_base+this.bounce_height*(1-k);return!0};a.prototype.init=function(a){this.sprite=a};a.prototype.onSpriteRemoved=function(){};return function(c){d=c;d.registerSpriteUpdater("bounce",a)}});
define("plugins/sprite/follow-mouse",[],function(){function a(){}var d=[0,0],c;a.prototype.update=function(a,e){c.mouseWorldPos(d);var k=this.sprite;k.x=d[0];k.y=d[1];return!0};a.prototype.init=function(a){this.sprite=a};a.prototype.onSpriteRemoved=function(){};return function(b){c=b;c.registerSpriteUpdater("follow_mouse",a)}});
define("plugins/sprite/animate",[],function(){function a(){}var d;a.prototype.update=function(a,b){var e=this.sprite,d=a-this.epoch,g;for(g in this.props)e[g]=this.tweenfn(d,this.begin[g],this.props[g],this.duration);return!0};a.prototype.init=function(a){this.sprite=a;void 0===this.duration&&(this.duration=a.maxDuration());this.begin={};for(var b in this.props)this.begin[b]=a[b];this.duration=Math.max(this.duration,1);if(!d.tweens.hasOwnProperty(this.tween))throw"Unrecognized tween in animate plugin: "+
this.tween;this.tweenfn=d.tweens[this.tween];this.epoch=d.getNow()};a.prototype.onSpriteRemoved=function(){};return function(c){d=c;d.registerSpriteUpdater("animate",a)}});
define("plugins/sprite/8way",[],function(){function a(){}var d;a.prototype.update=function(a,b){var e=this.sprite,d=e.directionx-e.x,g=2*(e.directiony-e.y);if(0===g)d=0===d?this.direction:0<d?"e":"w";else var h=d/g,d=0<=h?0.41421>h?0<g?"s":"n":2.4142<h?0<d?"e":"w":0<d?"se":"nw":-0.41421<h?0<g?"s":"n":-2.4142>h?0<d?"e":"w":0<d?"ne":"sw";this.direction=d;this.oldx=e.x;this.oldy=e.y;e.setState(e.stateName,this.direction);return!0};a.prototype.init=function(a){this.sprite=a;this.direction="e"};a.prototype.onSpriteRemoved=
function(){};return function(c){d=c;d.registerSpriteUpdater("8way",a)}});
define("plugins/sprite/track",[],function(){function a(){}var d;a.prototype.update=function(a,b){var e=this.sprite;if(e.x!==this.x||e.y!==this.y||e.h!==this.h)this.fn(e),this.x=e.x,this.y=e.y,this.h=e.h;return!0};a.prototype.onSpriteRemoved=function(){this.deregister&&this.deregister(this.sprite)};a.prototype.init=function(a){this.sprite=a;this.x=a.x;this.y=a.y;this.h=a.h;this.register&&this.register(a)};return function(c){d=c;d.registerSpriteUpdater("track",a)}});
define("plugins/layer/ui-layer",[],function(){function a(a,b){this.opts=b||{};this.name=a}var d;a.prototype.update=function(a){};a.prototype.draw=function(a,b){};return function(c){d=c;d.registerLayerPlugin("ui-layer",a,function(){})}});
define("plugins/layer/demo-trace",["util/js"],function(a){function d(a,c){this.opts=c||{};this.name=a;this.x=c.x;this.y=c.y;this.collider=b.createCollider("circle-trace",{radius:c.radius})}var c=a.copyProps,b;d.prototype.update=function(a){};d.prototype.draw=function(a,c){var d=[0,0],h=[0,0],l=[0,0],n,m,q;for(n=-200;200>n;n+=8)a.lineWidth=1,a.strokeStyle="yellow",a.beginPath(),b.mouseWorldPos(d),m=d[0]+n-this.x,q=d[1]-this.y,m=this.collider.test(Math.floor(this.x),Math.floor(this.y),Math.floor(m),
Math.floor(q),0,l),b.worldToScreenPos(l[0],l[1],l),b.worldToScreenPos(this.x,this.y,h),a.moveTo(h[0],h[1]),a.lineTo(l[0],l[1]),a.stroke(),a.beginPath(),a.strokeStyle=1>m?"red":"green",a.arc(l[0],l[1],2.5,0,2*Math.PI),a.stroke();for(n=-200;200>n;n+=8)a.lineWidth=1,a.strokeStyle="yellow",a.beginPath(),b.mouseWorldPos(d),m=d[0]-this.x,q=d[1]+n-this.y,m=this.collider.test(Math.floor(this.x),Math.floor(this.y),Math.floor(m),Math.floor(q),0,l),b.worldToScreenPos(l[0],l[1],l),b.worldToScreenPos(this.x,this.y,
h),a.moveTo(h[0],h[1]),a.lineTo(l[0],l[1]),a.stroke(),a.beginPath(),a.strokeStyle=1>m?"red":"green",a.arc(l[0],l[1],2.5,0,2*Math.PI),a.stroke()};d.prototype.set=function(a){c(a,this)};return function(a){b=a;b.registerLayerPlugin("demo-trace",d,function(){})}});
define("plugins/fx/particles",["sprites/sprite","sprites/composite","util/rnd"],function(a,d,c){function b(a){this.opts=a;var b="number"===typeof a.number?a.number:a.number(),c="function"===typeof a.x?a.x():a.x,d="function"===typeof a.y?a.y():a.y;this.duration="function"===typeof a.duration?a.duration():a.duration;this.epoch=e.getNow();this.endCallback=a.endCallback;for(this.comp=e.createComposite(c,d,a.id);0<b--;)c=a.spritePos||{x:0,y:0,h:0},this.comp.addSprite(a.def,a.state,c.x||0,c.y||0,c.h||0,
a.spriteOpts).particleData={xspeed:k(-400,400)/1E3,hspeed:k(-600,50)/1E3,xaccell:0,haccell:0.001,startx:c.x||0,starth:c.h||0,epoch:this.epoch}}var e,k=c.rnd,g=function(a,b){var c=a.particleData,d=b-c.epoch,e=d*d;a.x=Math.floor(c.startx+(c.xspeed*d+c.xaccell*e/2));a.h=Math.floor(c.starth-(c.hspeed*d+c.haccell*e/2));0>a.h&&(a.h=0)};b.prototype.update=function(a){this.comp.update(a,g.bind(this));if(void 0!==this.duration&&a-this.epoch>this.duration)return void 0!==this.endCallback&&this.endCallback(),
!1;a=this.comp.isActive();!a&&void 0!==this.endCallback&&this.endCallback();return a};return function(a){e=a;e.registerFxPlugin("particles",b)}});
define("plugins/ai/phasers/time-phaser",[],function(){function a(a,b){this.id=a;b=b||{};if(void 0===b.updatesPerSecond||1>b.updatesPerSecond)throw"Time phasers must define a >0 number of updates per second.";this.updatesPerSecond=b.updatesPerSecond;this.updatesThisFrame=this.lastUpdate=0}var d;a.prototype.initData=function(){return{lastUpdate:0}};a.prototype.phase=function(a,b){var d=a.phaserData[this.id];d.phaseOn&&(d.lastUpdate=b);return d.phaseOn};a.prototype.rebalance=function(a,b){var d=b-this.lastUpdate;
this.lastUpdate=b;var d=Math.floor(d*this.updatesPerSecond/1E3),k=this.id;a.sort(function(a,b){return b.phaserData[k].lastUpdate-a.phaserData[k].lastUpdate});for(var g=a.length-1;0<=g;g--)a[g].phaserData[this.id].phaseOn=0<d--};return function(c){d=c;d.registerPhaserPlugin("time-phaser",a)}});
define("plugins/ai/phasers/frame-phaser",[],function(){function a(a,b){this.id=a;b=b||{};if(void 0===b.phases||2>b.phases)throw"Frame phasers must have at least 2 phases.";this.phases=b.phases;this.buckets=Array(b.phases);this.bucketMax=Array(b.phases)}var d;a.prototype.initData=function(){return{phase:this.phases-1}};a.prototype.phase=function(a,b){return 0===a.phaserData[this.id].phase};a.prototype.rebalance=function(a,b){var d,k,g,h=0,l=this.buckets,n=a.length/this.phases;for(d=l.length-1;0<=d;d--)l[d]=
0,this.bucketMax[d]=Math.floor((d+1)*n-Math.floor(d*n));var m=[];for(d=a.length-1;0<=d;d--)k=a[d],g=k.phaserData[this.id],g.phase++,g.phase>=this.phases&&(g.phase=0),h=Math.max(h,++l[g.phase]),l[g.phase]>this.bucketMax[g.phase]&&m.push(k);if(0.8>n/h){h=0;for(d=m.length-1;0<=d;d--){for(k=m[d];l[h]>=this.bucketMax[h];)h++,h===this.phases&&(h=0);g=k.phaserData[this.id];l[g.phase]--;g.phase=h;l[h]++}}};return function(c){d=c;d.registerPhaserPlugin("frame-phaser",a)}});
define("plugins/camera/push-cam",[],function(){function a(a){this.follow=d.sprite(a.follow);if(!this.follow)throw"Camera can't follow missing sprite: "+a.follow;}var d;a.prototype.update=function(a){d.scrollTo(this.follow.x-d.clientWidth/2,this.follow.y-d.clientHeight/2)};return function(c){d=c;d.registerCameraPlugin("pushcam",a,function(){})}});
define("plugins/collision/lib/prop-scanner",[],function(){return function(a,d,c,b,e,k,g,h,l,n){var m=b,q=e,v=k,y=g,r,s=b+k|0,w=e+g|0;b|=0;e|=0;k=Math.abs(s-b);g=Math.abs(w-e);var p=0;void 0!==n&&(n.length=0,n.length=2*(Math.max(k,g)+1));if(0===k&&0===g)return l[0]=b,l[1]=e,a.getTilePropAtWorldPos(d,b,e),1;var t=b<s?1:-1,u=e<w?1:-1,f=k-g,x=!1,z=b,A=e;void 0!==n&&(n[p++]=b,n[p++]=e);r=2*f;r>-g&&(f-=g,b+=t);r<k&&(f+=k,e+=u);for(;;){if(b<c.le||b>c.re||e<c.te||e>c.be){x=!0;break}r=a.getTilePropAtWorldPos(d,
b,e);if(r>h){x=!0;break}z=b;A=e;void 0!==n&&(n[p++]=b,n[p++]=e);if(b===s&&e===w)break;r=2*f;r>-g&&(f-=g,b+=t);r<k&&(f+=k,e+=u)}x?void 0!==l&&(l[0]=z,l[1]=A):void 0!==l&&(l[0]=m+v,l[1]=q+y);void 0!==n&&(n.length=p);return!x?1:k>g?(l[0]-m)/v:(l[1]-q)/y}});
define("plugins/collision/lib/local-scanner",[],function(){var a=function(a,c,b,e,k){var g=a.getTilePropAtWorldPos(e,c+1,b+1)>k,g=g<<1|a.getTilePropAtWorldPos(e,c,b+1)>k,g=g<<1|a.getTilePropAtWorldPos(e,c-1,b+1)>k,g=g<<1|a.getTilePropAtWorldPos(e,c+1,b)>k,g=g<<1|a.getTilePropAtWorldPos(e,c-1,b)>k,g=g<<1|a.getTilePropAtWorldPos(e,c+1,b-1)>k,g=g<<1|a.getTilePropAtWorldPos(e,c,b-1)>k;return g=g<<1|a.getTilePropAtWorldPos(e,c-1,b-1)>k};return{localScan:a,ySlip:function(d,c,b,e,k,g){k/=g;if(2<=k&&3>=k){d=
a(d,c,b,"height",e);if(23===d)return 1;if(232===d)return-1}else if(-2>=k&&-3<=k){d=a(d,c,b,"height",e);if(240===d)return-1;if(15===d)return 1}return 0}}});
define("plugins/collision/sprite-with-map/line-trace",["plugins/collision/lib/prop-scanner","plugins/collision/lib/local-scanner"],function(a,d){function c(a){a=a||{};this.sn=b;this.edges=b.getWorldEdges();this.autoSlip=void 0===a.autoSlip?!0:a.autoSlip}var b,e=d.ySlip;c.prototype.test=function(c,d,h,l,n,m){this.autoSlip&&(d+=e(b,c,d,n,h,l));return a(b,"height",this.edges,c,d,h,l,n,m)};return function(a){b=a;b.registerColliderPlugin("line-trace",c,function(){})}});
define("plugins/collision/lib/ellipse",[],function(){return function(a,d){var c=a*a,b=d*d,e=2*c,k=2*b,g,h=0,l=d,n=0,m=e*l,q=[];q.push(h,l,-h,l,h,-l,-h,-l);for(g=Math.round(b-c*d+0.25*c);n<m;)h++,n+=k,0>g?g+=b+n:(l--,m-=e,g+=b+n-m),q.push(h,l,-h,l,h,-l,-h,-l);for(g=Math.round(b*(h+0.5)*(h+0.5)+c*(l-1)*(l-1)-c*b);0<l;)l--,m-=e,0<g?g+=c-m:(h++,n+=k,g+=c-m+n),q.push(h,l,-h,l,h,-l,-h,-l);return q}});
define("plugins/collision/sprite-with-map/circle-trace",["plugins/collision/lib/prop-scanner","plugins/collision/lib/ellipse","plugins/collision/lib/local-scanner"],function(a,d,c){function b(a){a=a||{};this.sn=e;if(void 0===a.radius||0===a.radius)throw"Circle trace requires a radius >0 in its options.";this.edges=e.getWorldEdges();this.samples=d(a.radius|0,a.radius/2|0);this.lineHit=[0,0];this.autoSlip=void 0===a.autoSlip?!0:a.autoSlip}var e,k=c.ySlip;b.prototype.test=function(b,c,d,n,m,q){var v,
y,r;if(this.autoSlip){var s=0;for(r=this.samples.length-2;0<=r;r-=2)if(v=this.samples[r],y=this.samples[r+1],v=k(e,b+v,c+y,m,d,n),0===s)s=v;else if(0!==v&&s!==v){s=0;break}c+=s}var s=[],w=a(e,"height",this.edges,b,c,d,n,m,this.lineHit,s),p,t,u=!0;for(r=s.length-2;2<=r&&u;r-=2){for(var u=!1,f=this.samples.length-2;0<=f;f-=2)if(v=this.samples[f],y=this.samples[f+1],p=s[r],t=s[r+1],e.getTilePropAtWorldPos("height",p+v,t+y)>m){u=!0;break}if(!u){if(r===s.length-2)return q[0]=this.lineHit[0],q[1]=this.lineHit[1],
w;q[0]=p;q[1]=t;return d>n?(p-b)/d:(t-c)/n}}q[0]=b;q[1]=c;return 0};return function(a){e=a;e.registerColliderPlugin("circle-trace",b,function(){})}});
define("plugins/default-plugins","plugins/sprite/bounce plugins/sprite/follow-mouse plugins/sprite/animate plugins/sprite/8way plugins/sprite/track plugins/layer/ui-layer plugins/layer/demo-trace plugins/fx/particles plugins/ai/phasers/time-phaser plugins/ai/phasers/frame-phaser plugins/camera/push-cam plugins/collision/sprite-with-map/line-trace plugins/collision/sprite-with-map/circle-trace".split(" "),function(){var a=arguments;return function(d){for(var c=0;c<a.length;c++)a[c](d)}});
define("animate/tween",[],function(){return{linear:function(a,d,c,b){return d+c*Math.min(1,a/b)},easeInOutCubic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(-2*b*a+3*b)},easeInOutQuintic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;a*=b;return d+c*(6*a*b+-15*b*b+10*a)},easeInQuintic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*b*a*b},easeInQuartic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*b*b},easeInCubic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a*a;return d+
c*b},easeInQuadratic:function(a,d,c,b){a=Math.min(b,a);return d+c*(a*a/b)},easeOutQuintic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;var e=b*a;return d+c*(e*b+-5*b*b+10*e+-10*b+5*a)},easeOutQuartic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(-1*b*b+4*b*a+-6*b+4*a)},easeOutCubic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(b*a+-3*b+3*a)},easeOutInCubic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(4*b*a+-6*b+3*a)},backInCubic:function(a,d,c,b){a=Math.min(b,a);
b=(a/=b)*a;return d+c*(4*b*a+-3*b)},backInQuartic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(2*b*b+2*b*a+-3*b)},outBackCubic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(4*b*a+-9*b+6*a)},outBackQuartic:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;return d+c*(-2*b*b+10*b*a+-15*b+8*a)},bounceOut:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;var e=b*a;return d+c*(33*e*b+-106*b*b+126*e+-67*b+15*a)},bounceIn:function(a,d,c,b){a=Math.min(b,a);b=(a/=b)*a;a*=b;return d+c*(33*a*b+
-59*b*b+32*a+-5*b)}}});define("ai/proximity-tracker",[],function(){function a(a,c){if(2>c||0!==(c&1)||c!==c|0)throw"Cell size must be an even integer > 0";this.cellw=c;this.cellh=c/2;this.sn=a;var b=a.getWorldEdges();this.le=b.le;this.re=b.re;this.te=b.te;this.be=b.be;this.id=a.util.uid()}a.prototype.track=function(a){};a.prototype.register=function(a){};a.prototype.unregister=function(a){};return a});
define("polyfills/requestAnimationFrame",[],function(){for(var a=0,d=["ms","moz","webkit","o"],c=0;c<d.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[d[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[c]+"CancelAnimationFrame"]||window[d[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),g=Math.max(0,16-(d-a)),h=window.setTimeout(function(){b(d+g)},g);a=d+g;return h});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})});
define("polyfills/bind",[],function(){Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var d=Array.prototype.slice.call(arguments,1),c=this,b=function(){},e=function(){return c.apply(this instanceof b&&a?this:a,d.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;e.prototype=new b;return e})});
define("snaps","sprites/spritedef sprites/sprite sprites/composite input/keyboard input/mouse util/all map/staggered-isometric plugins/default-plugins animate/tween ai/proximity-tracker polyfills/requestAnimationFrame polyfills/bind".split(" "),function(a,d,c,b,e,k,g,h,l,n){function m(m,p,t){function u(a){315532800<a&&0===f.epoch&&(f.epoch=a-16);a-=f.epoch;f.now=a;f.requestAnimationFrame(u);f.updateFX();f.map.updateLayers(a);f.updatePhasers();z(a-f.lastFrameTime);f.updateSprites();f.camera&&f.camera.update(a);
x(f.ctx);f.dbgShowRegions&&void 0!==f.map&&f.map.drawDebugRegions(f.ctx);f.dbgShowMouse&&(q(f.ctx,"Screen: "+f.mouse.x+","+f.mouse.y,5,15),q(f.ctx,"World: "+(f.mouse.x+f.map.xoffset)+","+(f.mouse.y+f.map.yoffset),5,30),q(f.ctx,"Origin: "+f.map.xoffset+","+f.map.yoffset,5,45));f.dbgShowCounts&&q(f.ctx,"Sprites: "+f.spriteCount(),5,f.clientHeight-15);if(f.dbgShowMouseTile&&void 0!==f.map){a=[0,0];f.mouseWorldPos(a);var b=[0,0];f.worldToTilePos(a[0],a[1],b);q(f.ctx,"Mouse in tile: "+b[0]+", "+b[1],5,
f.clientHeight-30)}f.lastFrameTime=f.now}var f=this;this.requestAnimationFrame=window.requestAnimationFrame.bind(window);this.util=k;this.tweens=l;this.ProximityTracker=n.bind(n,this);t=t||{};this.dbgShowMouse=!!t.showMouse;this.dbgShowCounts=!!t.showCounts;this.dbgShowRegions=!!t.showRegions;this.dbgShowMouseTile=!!t.showMouseTile;this.imageCache={};this.spriteUpdaters={};this.colliders={};this.fxUpdaters={};this.layerPlugins={};this.cameraPlugins={};this.phaserPlugins={};this.timers={};this.cameras=
{};this.camera=null;this.activeFX=[];this.epoch=this.now=0;p=document.getElementById(p);this.clientWidth=p.clientWidth;this.clientHeight=p.clientHeight;this.ctx=p.getContext("2d");this.keyboard=new b;this.mouse=new e(p);this.ctx.fillStyle="#000022";this.ctx.fillRect(0,0,p.clientWidth,p.clientHeight);this.game=m;if(void 0!==m.map){if("object"!==typeof m.hitTests||void 0===m.hitTests.hit)throw"Game must define a hitTests object with at least a 'hit' property";this.map=new g(m.map,m.hitTests,this.clientWidth,
this.clientHeight)}var x=f.game.draw,z=f.game.update;this.spriteDefs={};this.sprites=[];this.phasers=[];this.spriteMap={};this.lastFrameTime=0;this.registerSpriteUpdater=function(a,b){f.spriteUpdaters[a]=b};this.registerFxPlugin=function(a,b){f.fxUpdaters[a]=b};this.registerLayerPlugin=function(a,b,c){c.call(this);f.layerPlugins[a]=b};this.registerColliderPlugin=function(a,b,c){f.colliders[a]={fn:b,init:c}};this.registerCameraPlugin=function(a,b,c){f.cameraPlugins[a]={fn:b,init:c}};this.registerPhaserPlugin=
function(a,b){f.phaserPlugins[a]={fn:b}};h(this);if("function"===typeof f.game.onEngineStart)f.game.onEngineStart(this);p=new r;void 0!==this.map&&this.map.primePreloader(p);if("object"===typeof m.preloadImages){t=function(a,b){f.imageCache[b]=a};for(var A in m.preloadImages)p.add(m.preloadImages[A],A,t)}if("object"===typeof f.game.spriteDefs){m=function(b,c){var d=f.game.spriteDefs[c],e=new a(b,d.w,d.h,d.x,d.y);f.spriteDefs[c]=e;for(var g in d.states)e.addState(g,d.states[g].seq,d.states[g].dur)};
for(var B in f.game.spriteDefs)p.add(f.game.spriteDefs[B].path,B,m)}this.drawImage=function(a,b,c){f.ctx.drawImage(f.imageCache[a],b,c)};this.cls=function(a){f.ctx.fillStyle=a||"#000";f.ctx.fillRect(0,0,f.clientWidth,f.clientHeight)};this.bindKeys=function(a){for(var b=0;b<a.length;b++){var c=a[b];f.keyboard.bind(c.key,c.action)}};this.updatePhasers=function(){for(var a=f.phasers.length-1;0<=a;a--){for(var b=[],c=f.phasers[a].id,d=f.sprites.length-1;0<=d;d--){var e=f.sprites[d];void 0!==e.phaserData&&
e.phaserData.hasOwnProperty(c)&&b.push(e)}0<b.length&&f.phasers[a].rebalance(b,f.now)}};this.updateFX=function(){for(var a=f.activeFX.length-1;0<=a;a--)f.activeFX[a].update(f.now)||f.activeFX.splice(a,1)};this.fx=function(a,b){if(!f.fxUpdaters.hasOwnProperty(a))throw"Can't create FX for unregistered FX type: "+a;f.activeFX.push(new f.fxUpdaters[a](b))};this.addLayer=function(a,b,c,d){if(!f.layerPlugins.hasOwnProperty(b))throw"Can't create layer for unregistered layer type: "+b;a=new f.layerPlugins[b](a,
c);f.map.insertLayer(d,a);return a};this.spriteCount=function(){for(var a=0,b=0;b<f.sprites.length;b++){var d=f.sprites[b];d instanceof c?a+=d.sprites.length:a++}return a};p.load(function(){void 0!==f.map&&f.map.resolveTiles();if("function"===typeof f.game.onResourcesLoaded)f.game.onResourcesLoaded();setTimeout(function(){u(0)},0)},function(a){if("function"===typeof f.game.onProgress)f.game.onProgress(a,f.ctx)},function(){if("function"===typeof f.game.onLoadError)f.game.onLoadError()});this.actioning=
function(a){return f.keyboard.actionPressed(a)};this.scroll=function(a,b){f.map.scroll(a,b)};this.scrollTo=function(a,b){f.map.scrollTo(a,b)};this.getWorldEdges=function(){return f.map.getWorldEdges()};this.drawWorld=function(){this.map.drawWorld(f.ctx,f.now,f.sprites)};this.drawSpriteWorld=function(a){f.spriteMap[a].draw(f.ctx,f.map.xoffset,f.map.yoffset,f.now)};this.mouseScreenPos=function(a){a[0]=f.mouse.x;a[1]=f.mouse.y};this.mouseWorldPos=function(a){f.map.screenToWorldPos(f.mouse.x,f.mouse.y,
a)};this.worldToTilePos=function(a,b,c){this.map.worldToTilePos(a,b,c)};this.screenToTilePos=function(a,b,c){this.map.screenToTilePos(a,b,c)};this.screenToWorldPos=function(a,b,c){this.map.screenToWorldPos(a,b,c)};this.worldToScreenPos=function(a,b,c){this.map.worldToScreenPos(a,b,c)};this.getTilePropAtWorldPos=function(a,b,c){return this.map.getTilePropAtWorldPos(a,b,c)};this.createCollider=function(a,b){if(!f.colliders.hasOwnProperty(a))throw"Warning: undefined collider plugin: "+a;return new f.colliders[a].fn(b)};
this.createCamera=function(a,b,c){if(!f.cameraPlugins.hasOwnProperty(b))throw"Warning: undefined camera plugin: "+b;if(this.cameras.hasOwnProperty(a))throw"Camera already exists: "+a;this.cameras[a]=new f.cameraPlugins[b].fn(c);return this.cameras[a]};this.switchToCamera=function(a){this.camera=this.cameras[a]};this.spawnSprite=function(a,b,c,e,g,k,h){void 0===h&&(h={});var l=h.id;if(void 0===l)l=s();else if(f.spriteMap.hasOwnProperty(l))throw"Error: duplicate sprite id "+l;if(!f.spriteDefs.hasOwnProperty(a))throw"Error: Missing sprite definition when spawning sprite "+
a;a=f.spriteDefs[a];var m=h.updates,n;if(void 0!==m)for(var m=Array(h.updates.length),p=0;p<h.updates.length;p++){var q=h.updates[p],r=q.name;if(!f.spriteUpdaters.hasOwnProperty(r))throw"Sprite plugin used but not registered: "+r;m[p]=new f.spriteUpdaters[r];q.hasOwnProperty("phaser")&&(void 0===n&&(n={}),n[q.phaser.id]=q.phaser.initData());v(q,m[p])}h=y(h);h.updates=m;h.phaserData=n;e=new d(f,a,e,g,k,h);e.setState(b,c);if(void 0!==h.opts)for(var t in h.opts)e[t]=h.opts[t];e.init();f.sprites.push(e);
return f.spriteMap[l]=e};this.createComposite=function(a,b,d,e){if(void 0===d)d=s();else if(f.spriteMap.hasOwnProperty(d))throw"Warning: duplicate sprite (composite) id "+d;a=new c(this,a,b,d,e);a.init();f.sprites.push(a);return f.spriteMap[d]=a};this.markTime=function(a,b){f.timers[a]=f.now+b};this.checkTimer=function(a,b){if(void 0===f.timers[a])return!1;var c=f.timers[a];if(0<f.now-c){if(void 0===b)delete f.timers[a];else{b=Math.max(1,b);do c+=b;while(c<f.now);f.timers[a]=c}return!0}return!1};
this.sprite=function(a){return f.spriteMap[a]};this.updateSprites=function(){for(var a=[],b=0;b<f.sprites.length;b++){var c=f.sprites[b];c.isActive(f.now)?(c.update(f.now),a.push(c)):(c.onRemove(),delete f.spriteMap[c.name])}f.sprites=a};this.getNow=function(){return f.now};this.createPhaser=function(a,b){if(!f.phaserPlugins.hasOwnProperty(a))throw"Can't create phaser for unregistered type: "+a;var c=new f.phaserPlugins[a].fn(s(),b);this.phasers.push(c);return c};this.resizeCanvas=function(){}}var q=
k.debug.debugText,v=k.js.copyProps,y=k.js.clone,r=k.Preloader,s=k.uid;m.util=k;return m});
